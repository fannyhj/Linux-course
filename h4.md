## Tiivistelmä

Voit hallita valtavaa määrää daemoneja konfiguraationhallintajärjestelmällä. Paketti-tiedostopalvelu on yleinen malli tähän: asenna ohjelmisto, vaihda määritystiedosto ja käynnistä daemon uudelleen uuden kokoonpanon käyttämiseksi.

Create SSH State

Apply the State to Slaves

Test

Using one of your slaves as a target (instead of tero.example.com)

Ensimmäisenä tarkistin onko ssh asennettu komennolla 'sudo ss -tlnp | grep ssh'.
<img width="814" height="129" alt="image" src="https://github.com/user-attachments/assets/a346c06e-cda3-4d5b-950c-1c29434fddea" />
1. SSHD kuuntelee vain porttia 22

0.0.0.0:22 → IPv4:ssä portti 22 auki kaikille osoitteille

[::]:22 → IPv6:ssä portti 22 auki kaikille osoitteille

2. Uutta porttia ei ole (esim. 2222)

→ Eli SSHd ei vielä kuuntele kuin porttia 22.

sudoedit /etc/ssh/sshd_config
<img width="828" height="468" alt="image" src="https://github.com/user-attachments/assets/cb40cb0b-fdfd-4b9b-b501-450eaceb2615" />

sudo systemctl restart ssh
<img width="805" height="177" alt="image" src="https://github.com/user-attachments/assets/b1f94efb-1a43-4942-8486-1aa8346a6b85" />

sudo apt-get update
sudo apt-get install -y openssh-server
<img width="778" height="142" alt="image" src="https://github.com/user-attachments/assets/e36c4eb2-cc00-4339-8d56-4a736fe7cf61" />

nc -vz localhost 2222
command not found

sudo apt-get update
sudo apt-get install -y netcat-openbsd
<img width="799" height="379" alt="image" src="https://github.com/user-attachments/assets/eac7837b-ac27-4730-b704-08d7fc170e6d" />

Uusi yritys
<img width="657" height="61" alt="image" src="https://github.com/user-attachments/assets/1b1fa9bf-d1df-4488-b93f-32dbdafa23da" />

sudo apt-get remove --purge openssh-server
<img width="801" height="373" alt="image" src="https://github.com/user-attachments/assets/ab56f984-72b4-4040-81f5-6ebfe06afd36" />

Luo Saltin hallitsema asetustiedosto
sudoedit /srv/salt/ssh/sshd_config
<img width="741" height="203" alt="image" src="https://github.com/user-attachments/assets/71bcda93-2241-4032-9d7c-1702d1a0c8ea" />

sudoedit /srv/salt/ssh/init.sls
<img width="521" height="344" alt="image" src="https://github.com/user-attachments/assets/84909dc6-0a98-43da-b18b-61b84e8af781" />

sudo salt-call --local state.apply ssh
<img width="770" height="471" alt="image" src="https://github.com/user-attachments/assets/5a2cce5a-058c-486b-8019-a7e0a0251e04" />

Tarkista, että asetukset ovat korjautuneet
grep Port /etc/ssh/sshd_config
<img width="652" height="61" alt="image" src="https://github.com/user-attachments/assets/46eeeaa0-9911-44cd-8d20-da371caa2775" />

Porttitesti
nc -vz localhost 22
nc -vz localhost 2222
<img width="692" height="98" alt="image" src="https://github.com/user-attachments/assets/bdfc1577-8c0c-4463-bab1-e18fcf4e8b5f" />




