# H1 - Viisikko

## Tiivistelmä: Install Salt on Debian 13 Trixie - (https://terokarvinen.com/install-salt-on-debian-13-trixie/)
- Asennukseen tarvitaan uusi repository, koska Salt ei ole saatavilla Debianin vakiovarastoissa.
- Uuden ohjelmiston lisäämisellä apt-tietovarastoon päivitykset tapahtuvat automaattisesti, jos on asennettu myös unattended-upgrades paketti. Voidaan tehdä myös manuaalisena käyttämällä sudo apt-get update; sudo apt-get dist-upgrade komentoa.
- Ensiksi pitää ladata wget, jonka jälkeen etsitään kaksi tiedostoa Salt:in virallisista asennnusohjeista ja tutkitaan niiden sisältöä (PGP julkinen avain ja sormenjälki).
- Luotetaan avaimeen ja asennetaan Salt.
- Testataan, että toimiiko Salt.
- Ohjeet asennukseen olivat mielestäni selkeät.

## Tiivistelmä: Run Salt Command Locally - (https://terokarvinen.com/2021/salt-run-command-locally/)
- Ladataan Salt-slave.
- Asennetaan tree-ohjelmisto.
- Luodaan tiedosto ja lisätään sen sisällöksi "foo" ja sitten poistetaan se.
- Käynnistetään apache ja varmistetaan, että se on päällä ja sitten pysäytetään palvelu.
- Luodaan ja poistetaan käyttäjän tili.
- Ajetaan komento vain jos tiedosto /tmp/foo ei ole olemassa.
- Artikkeli oli hyödyllinen ja suoraviivainen, mutta toivoin lisää tietoa siitä mitä komennot tekevät.

## Tiivistelmä: Salt Quickstart - (https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/)
- Asennetaan master, jos masterilla on palomuuri, tarvitsee se käytön portteihin 4505/tcp ja 4506/tcp. Jos palomuuria ei ole asennettu, ei tarvitse huolehtia.
- Asennetaan orja, orjan pitää tietää missä master on muokkaamalla /etc/salt/minioniin master-kohtaan hostnamen.
- Käynnistetään salt-minion.service uudelleen, että päästään käyttämään uusia asetuksia.
- Kokeillaan eri komentoja orjilla.
- Pidin ohjeista sekä lisätiedoista.

## Tiivistelmä: Raportin kirjoittaminen - (https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/)
- Raportin tulee olla toistettava, eli toisen henkilön pitää saada sama tulos raportin perusteella.
- Raportin tulee olla täsmällinen, eli kaikki komennot, kellonajat, onnistumiset ja haasteet on lisättävä.
- Raportin pitää olla helppolukuinen. Pitää välttää väliotsikoita, kirjoittaa huolellista kieltä ja loppuun on hyvä kirjoittaa tiivistelmä.
- Täytyy viitata lähteisiin.
- Ei saa kertoa, että on tehnyt jotain mitä ei oikeasti olekkaan.
- Ei saa plagioida eikä ottaa kuvia luvattomasti osaksi työtä.
- Kellonaikojen lisääminen raportteihin voi mielestäni käydä työlääksi, mutta ohjeet olivat muutoin selkeät ja avuliaat.

## Raportti:

Asensin ensiksi itselleni Debian 13-Trixien Debian.orgista, jossa minulle ei ilmentynyt ongelmia. Tämän jälkeen ajoin uudella virtuaalikoneellani päivitykset komennolla "sudo apt-get update". Sitten latasin Salt-minionin komennolla "sudo apt-get install salt-minion salt-master" käyttäen apuna opettajani, Tero Karvisen, ohjeita "Install Salt on Debian 13 Trixie". Testasin toimivuuden komennolla "salt --version", josta sain hyväksytyn ilmoituksen. Tämän jälkeen ajoin komennon "sudo salt-call --local state.single file.managed /tmp/hellotero". Katsoin sitten, että tiedosto on olemassa komennolla "ls /tmp/hellotero" ja sain sen näkyville. (Terokarvinen.com 2025)

Kokeilin tämän jälkeen Saltin tilafunktioita pkg, file, service, user ja cmd, käyttäen Tero Karvisen ohjeita "Run Salt Command Locally". Ensimmäisenä katsoin oliko tree-ohjelma ladattuna. Kirjoitin komennon "sudo salt-call --local -l info state.single pkg.installed tree ja sain näkymän jossa luki mm. "The following packages were installed/updated: tree" ja vahvistuksen onnistumisesta "Succeeded: 1 (changed=1) Failed: 0". Tämä ilmoitus tarkoittaa sitä, että Salt teki muutoksen, koska tila ei ollut jo halutun mukainen. Tämän jälkeen poistin ohjelmiston komennolla "sudo salt-call --local -l info state.single pkg.removed tree" ja sain kommentiksi "All targeted packages were removed.". (Terokarvinen.com 2023)

Tämän jälkeen loin tiedoston komennolla "sudo salt-call --local -l info state.single file.managed /tmp/hellotero". Sain jälleen "Succeeded: 1". Sitten loin tiedoston jonka sisältö on
"foo" komennolla "sudo salt-call --local -l info state.single file.managed /tmp/moitero contents="foo". Sain info-ikkunaan kommentin "File /tmp/moitero updated". Viimeiseksi poistin ensimmäisen tiedoston komennolla "sudo salt-call --local -l info state.single file.absent /tmp/hellotero", jonka jälkeen sain kommentin "Removed file /tmp/hellotero". Seuraavaksi automatisoin daemonin uudelleenkäynnistyksen komennolla "sudo salt-call --local -l info state.single service.running apache2 enable=True" ja sitten pysäytin palvelun komennolla "sudo salt-call --local -l info state.single service.dead apache2 enable=False".

Sitten loin käyttäjän komennolla "sudo salt-call --local -l info state.single user.present terote08". Virtuaalikoneelleni ilmestyi ikkuna, jossa oli muuun muassa
'home: /home/terote08', 'homephone', 'name: terote08', 'other', 'passwd: x', 'roomnumber', 'shell: /bin/sh' 'uid: 1001' ja workphone'. Poistin käyttäjän komennolla "sudo salt-call --local -l info state.single user.absent terote08", jonka jälkeen info-ikkunassa luki
"terote08: removed" ja "terote08 group: removed". Ajoin sitten komennon, joka toimii vain, jos /tmp/foo ei ole olemassa komennolla "sudo salt-call --local -l info state.single cmd.run 'touch /tmp/foo' creates="/tmp/foo"". Sain tästäkin lopputulokseksi onnistumisesta kertovan ilmoituksen. (Terokarvinen.com 2023)

Viimeisenä osana harjoitusta latasin Masterin käyttäen Tero Karvisen ohjeita "Salt Quickstart". Aloitin päivittämällä koneen jälleen komennolla "sudo apt-get install", jonka jälkeen latasin masterin komennolla "sudo apt-get -y install salt-master". Latauksen jälkeen katsoin hostnamen komennolla "hostname -I", josta sain tulostuksen "10.0.2.15". Latasin sitten orjan komennolla "sudo apt-get -y install salt-minion". Orjan pitää tietää missä master on, jonka vuoksi menin muokkaamaan tiedostoa, josta se etsii tietoa komennolla "sudoedit /etc/salt/minion". Kirjoitin "master" kohtaan hostnameni eli 10.0.2.15 ja lisäsin id:ksi "tero". Uusien asetusten käyttöönottamiseen piti minun uudelleenkäynnistää orja daemon komennolla "sudo systemctl restart salt-minion.service". Hyväksyin sitten orjan avaimen masterilla komennolla "sudo salt-key -A" ja painoin Y, eli yes. Kokeilin sitten orjaa komennolla "sudo salt '*' cmd.run 'whoami' ja sain vastaukseksi "tero: root", eli sain sen toimimaan. (Terokarvinen.com 2018)
<img width="992" height="598" alt="image" src="https://github.com/user-attachments/assets/8a05cc4b-f1cf-418b-8b59-0dd9a39a1d78" />

Idempotenssissa, jos komento ajetaan, mutta tiedostoa ei ole, niin Salt luo sen, mutta jos tiedosto on jo olemassa niin Salt ei tee mitään. Tästä esimerkkinä aikaisemmin tekemäni tiedosto "/tmp/moitero". Tässä vaiheessa Salt loi tiedoston ja lisäsi sisältöön "foo", 
koska tiedostoa ei ollut aikaisemmin olemassa. Jos tiedostoolisi jo olemassa ja sen sisältö olisi "foo", Salt ei tekisi mitään muutoksia ja tuloksena näkyisi "Succeeded: 1 (changed=0). Changed=0 kertoo, että tila oli jo oikein, eli komento olisi idempotentti.

Harjoitukset olivat hyviä oppimiseni tukemisessa ja niiden tekemisessä virtuaalikoneella ei kestänyt kauaa. Kaikki kokeiluni onnistuivat ongelmitta ja opin harjoituksien kautta paljon uutta Saltista ja komentojen käytöstä.

## Lähteet:
Karvinen, Tero 2025: Install Salt on Debian 13 Trixie. (https://terokarvinen.com/install-salt-on-debian-13-trixie/)

Karvinen, Tero 2023: Run Salt Command Locally. (https://terokarvinen.com/2021/salt-run-command-locally/)

Karvinen, Tero 2018: Salt Quickstart - Salt Stack Master and Slave on Ubuntu Linux. (https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/)

Karvinen, Tero 2006: Raportin kirjoittaminen. (https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/)
